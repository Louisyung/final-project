<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>è§’è‰²è¨­å®š</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-gray-800 to-gray-900 text-white min-h-screen flex items-center justify-center">

  <div class="flex gap-8 w-full max-w-5xl">
    <!-- å·¦å´è§’è‰²è¨­å®šå€åŸŸ -->
    <div class="bg-gray-800 p-8 rounded-2xl shadow-xl w-1/2">
      <h1 class="text-3xl font-bold mb-6 text-center">è¨­å®šä½ çš„è§’è‰²èˆ‡åŠ‡æƒ…</h1>

      <!-- åŠ‡æƒ…é¡å‹ï¼ˆæŒ‰éˆ•é¸æ“‡ï¼‰ -->
      <div class="mb-6">
        <label class="block mb-2 text-sm font-medium">åŠ‡æƒ…é¡å‹</label>
        <div class="flex flex-wrap gap-2">
          <button type="button" class="story-btn bg-teal-500 hover:bg-teal-400 text-white font-bold py-2 px-4 rounded-lg transition" data-value="æ ¡åœ’æˆ€æ„›">æ ¡åœ’æˆ€æ„›</button>
          <button type="button" class="story-btn bg-teal-500 hover:bg-teal-400 text-white font-bold py-2 px-4 rounded-lg transition" data-value="å†’éšªæ—…ç¨‹">å†’éšªæ—…ç¨‹</button>
          <button type="button" class="story-btn bg-teal-500 hover:bg-teal-400 text-white font-bold py-2 px-4 rounded-lg transition" data-value="ç§‘å¹»æœªä¾†">ç§‘å¹»æœªä¾†</button>
          <button type="button" class="story-btn bg-teal-500 hover:bg-teal-400 text-white font-bold py-2 px-4 rounded-lg transition" data-value="æ‡¸ç–‘æ¨ç†">æ‡¸ç–‘æ¨ç†</button>
          <button type="button" class="story-btn bg-teal-500 hover:bg-teal-400 text-white font-bold py-2 px-4 rounded-lg transition" data-value="å¥‡å¹»å†’éšª">å¥‡å¹»å†’éšª</button>
          <button type="button" class="story-btn bg-teal-500 hover:bg-teal-400 text-white font-bold py-2 px-4 rounded-lg transition" data-value="æ­·å²ç©¿è¶Š">æ­·å²ç©¿è¶Š</button>
          <button type="button" class="story-btn bg-teal-500 hover:bg-teal-400 text-white font-bold py-2 px-4 rounded-lg transition" data-value="ææ€–é©šæ‚š">ææ€–é©šæ‚š</button>
          <button type="button" class="story-btn bg-teal-500 hover:bg-teal-400 text-white font-bold py-2 px-4 rounded-lg transition" data-value="éŸ³æ¨‚é’æ˜¥">éŸ³æ¨‚é’æ˜¥</button>
        </div>
      </div>

      <!-- è‡ªè¨‚åŠ‡æƒ…é¡å‹è¼¸å…¥æ¡† -->
      <div class="mb-6">
        <label class="block mb-2 text-sm font-medium">è‡ªè¨‚åŠ‡æƒ…é¡å‹</label>
        <div class="flex gap-2">
          <input type="text" id="customStoryType" class="w-full p-2 rounded bg-gray-700 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-teal-500" placeholder="è¼¸å…¥è‡ªè¨‚åŠ‡æƒ…é¡å‹ï¼ˆä¾‹å¦‚ï¼šå¥‡å¹»å†’éšªï¼‰" />
          <button
            id="confirmCustomStoryType"
            class="bg-teal-500 hover:bg-teal-400 text-white font-bold py-2 px-4 rounded-lg transition"
          >
            ç¢ºå®š
          </button>
        </div>
      </div>

      <!-- æ–°å¢è§’è‰²æŒ‰éˆ• -->
      <div id="addCharacterSection" class="hidden">
        <button
          onclick="showCharacterForm()"
          class="w-full bg-teal-500 hover:bg-teal-400 text-white font-bold py-2 px-4 rounded-lg transition"
        >
          æ–°å¢è§’è‰²
        </button>
      </div>

      <!-- è§’è‰²è¨­å®šè¡¨å–® -->
      <div id="characterForm" class="hidden">
        <!-- è§’è‰²åç¨± -->
        <div class="mb-4">
          <label class="block mb-2 text-sm font-medium">è§’è‰²åç¨±</label>
          <input type="text" id="characterName" class="w-full p-2 rounded bg-gray-700 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-teal-500" placeholder="ä¾‹å¦‚ï¼šæ—è•™å½¤" />
        </div>

        <!-- è§’è‰²æ€§æ ¼ï¼ˆå¤šé¸ï¼‰ -->
        <div class="mb-4">
          <label class="block mb-2 text-sm font-medium">è§’è‰²æ€§æ ¼ï¼ˆå¯å¤šé¸ï¼‰</label>
          <div class="flex flex-wrap gap-2">
            <label><input type="checkbox" class="mr-1" value="æº«æŸ”" /> æº«æŸ”</label>
            <label><input type="checkbox" class="mr-1" value="æ´»æ½‘" /> æ´»æ½‘</label>
            <label><input type="checkbox" class="mr-1" value="å‚²å¬Œ" /> å‚²å¬Œ</label>
            <label><input type="checkbox" class="mr-1" value="ç†æ€§" /> ç†æ€§</label>
            <label><input type="checkbox" class="mr-1" value="ä¸­äºŒ" /> ä¸­äºŒ</label>
            <label><input type="checkbox" class="mr-1" value="è…¹é»‘" /> è…¹é»‘</label>
          </div>
        </div>

        <!-- ç¢ºèªæŒ‰éˆ• -->
        <button
          onclick="addCharacter()"
          class="w-full bg-teal-500 hover:bg-teal-400 text-white font-bold py-2 px-4 rounded-lg transition"
        >
          ç¢ºå®šæ–°å¢è§’è‰²
        </button>
      </div>
    </div>

    <!-- å³å´è§’è‰²é¡¯ç¤ºå€åŸŸ -->
    <div id="characterDisplay" class="bg-gray-700 p-8 rounded-2xl shadow-xl w-1/2">
      <h2 class="text-2xl font-bold mb-4">å·²æ–°å¢è§’è‰²</h2>
      <ul id="characterList" class="space-y-4">
        <!-- æ–°å¢è§’è‰²å¾Œæœƒé¡¯ç¤ºåœ¨é€™è£¡ -->
      </ul>
    </div>
  </div>

  <!-- é–‹å§‹ç”ŸæˆåŠ‡æœ¬æŒ‰éˆ• -->
  <button
    id="generateScriptButton"
    class="fixed bottom-8 right-8 bg-teal-500 hover:bg-teal-400 text-white font-bold py-3 px-6 rounded-full shadow-lg transition"
    onclick="generateScript()"
  >
    è¨­å®šåŠ‡æƒ…æ–¹å‘
  </button>

  <script>
    let selectedStoryType = "";
    const characters = [];

    // ç›£è½åŠ‡æƒ…é¡å‹æŒ‰éˆ•é»æ“Š
    document.querySelectorAll(".story-btn").forEach(button => {
      button.addEventListener("click", () => {
        selectedStoryType = button.getAttribute("data-value");
        document.querySelectorAll(".story-btn").forEach(btn => btn.classList.remove("bg-teal-600"));
        button.classList.add("bg-teal-600");

        // é¡¯ç¤ºæ–°å¢è§’è‰²æŒ‰éˆ•
        document.getElementById("addCharacterSection").classList.remove("hidden");
      });
    });

    // è‡ªè¨‚åŠ‡æƒ…é¡å‹çš„è™•ç†é‚è¼¯
    function handleCustomStoryType() {
      const customStoryType = document.getElementById("customStoryType").value.trim();
      if (customStoryType) {
        selectedStoryType = customStoryType;

        // é¡¯ç¤ºæ–°å¢è§’è‰²æŒ‰éˆ•
        document.getElementById("addCharacterSection").classList.remove("hidden");
        alert(`å·²é¸æ“‡è‡ªè¨‚åŠ‡æƒ…é¡å‹ï¼š${customStoryType}`);
      } else {
        alert("è«‹è¼¸å…¥è‡ªè¨‚åŠ‡æƒ…é¡å‹ï¼");
      }
    }

    // ç›£è½è‡ªè¨‚åŠ‡æƒ…é¡å‹è¼¸å…¥æ¡†çš„ Enter éµ
    document.getElementById("customStoryType").addEventListener("keydown", (event) => {
      if (event.key === "Enter") {
        handleCustomStoryType();
      }
    });

    // ç›£è½ç¢ºå®šæŒ‰éˆ•é»æ“Š
    document.getElementById("confirmCustomStoryType").addEventListener("click", () => {
      handleCustomStoryType();
    });

    function showCharacterForm() {
      // é¡¯ç¤ºè§’è‰²è¨­å®šè¡¨å–®
      document.getElementById("characterForm").classList.remove("hidden");
    }

    function addCharacter() {
      const name = document.getElementById("characterName").value.trim();
      const traits = Array.from(document.querySelectorAll('input[type="checkbox"]:checked'))
                          .map(cb => cb.value);

      if (!name) {
        alert("è«‹è¼¸å…¥è§’è‰²åç¨±ï¼");
        return;
      }

      if (!selectedStoryType) {
        alert("è«‹é¸æ“‡åŠ‡æƒ…é¡å‹ï¼");
        return;
      }

      // å„²å­˜è§’è‰²è³‡æ–™
      characters.push({ name, traits });

      // æ›´æ–°å³å´è§’è‰²é¡¯ç¤ºå€åŸŸ
      const characterList = document.getElementById("characterList");
      const listItem = document.createElement("li");
      listItem.classList.add("bg-gray-800", "p-4", "rounded-lg", "shadow");
      listItem.innerHTML = `
        <h3 class="text-lg font-bold">${name}</h3>
        <p class="text-sm">æ€§æ ¼ï¼š${traits.join(", ") || "ç„¡"}</p>
      `;
      characterList.appendChild(listItem);

      // æ¸…ç©ºè§’è‰²è¡¨å–®
      document.getElementById("characterName").value = "";
      document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
    }

    // ä¿®æ”¹ generateScript å‡½æ•¸ï¼Œå¢åŠ è½‰ç§»åˆ° scriptScreen.html çš„åŠŸèƒ½
    function generateScript() {
      if (characters.length === 0) {
        alert("è«‹å…ˆæ–°å¢è‡³å°‘ä¸€å€‹è§’è‰²ï¼");
        return;
      }
      if (!selectedStoryType) {
        alert("è«‹é¸æ“‡æˆ–è¼¸å…¥åŠ‡æƒ…é¡å‹ï¼");
        return;
      }

      // å½ˆå‡ºè¼¸å…¥è¦–çª—ï¼Œè®“ä½¿ç”¨è€…è¼¸å…¥åŠ‡æƒ…æ–¹å‘
      const storyDirection = prompt("è«‹è¼¸å…¥åŠ‡æƒ…æ–¹å‘ï¼š", "ä¾‹å¦‚ï¼šè§’è‰²å¦‚ä½•ç›¸é‡ã€å†’éšªçš„èµ·é»ç­‰");

      if (storyDirection) {
        alert(`åŠ‡æƒ…æ–¹å‘å·²è¨­å®šï¼š${storyDirection}\nè§’è‰²æ•¸é‡ï¼š${characters.length}\nåŠ‡æƒ…é¡å‹ï¼š${selectedStoryType}`);
        // åœ¨æ­¤è™•æ·»åŠ ç”ŸæˆåŠ‡æœ¬çš„é‚è¼¯ï¼Œä½¿ç”¨ storyDirection

        // ç¢ºå®šå¾Œè½‰ç§»åˆ° scriptScreen.html
        window.location.href = "scriptScreen.html";
      } else {
        alert("æœªè¼¸å…¥åŠ‡æƒ…æ–¹å‘ï¼Œè«‹é‡æ–°è¨­å®šï¼");
      }
    }

    // æ·»åŠ é›ªèŠ±æ•ˆæœçš„ CSS å’Œ JavaScript
    const snowflakeContainer = document.createElement('div');
    snowflakeContainer.style.position = 'fixed';
    snowflakeContainer.style.top = '0';
    snowflakeContainer.style.left = '0';
    snowflakeContainer.style.width = '100%';
    snowflakeContainer.style.height = '100%';
    snowflakeContainer.style.pointerEvents = 'none';
    snowflakeContainer.style.overflow = 'hidden';
    document.body.appendChild(snowflakeContainer);

    function createSnowflake() {
      const snowflake = document.createElement('div');
      snowflake.textContent = 'â„';
      snowflake.style.position = 'absolute';
      snowflake.style.color = 'white';
      snowflake.style.fontSize = Math.random() * 10 + 10 + 'px';
      snowflake.style.top = '-10px';
      snowflake.style.left = Math.random() * window.innerWidth + 'px';
      snowflake.style.opacity = Math.random();
      snowflake.style.animation = `fall ${Math.random() * 3 + 2}s linear`; // éš¨æ©Ÿä¸‹è½æ™‚é–“

      snowflakeContainer.appendChild(snowflake);

      // ç§»é™¤é›ªèŠ±
      snowflake.addEventListener('animationend', () => {
        snowflakeContainer.removeChild(snowflake);
      });
    }

    // å®šæœŸç”Ÿæˆé›ªèŠ±
    setInterval(createSnowflake, 200);

    // æ·»åŠ  CSS å‹•ç•«
    const style = document.createElement('style');
    style.textContent = `
      @keyframes fall {
        to {
          transform: translateY(100vh);
        }
      }
    `;
    document.head.appendChild(style);

    // æ·»åŠ èƒŒæ™¯éŸ³æ¨‚
    const audio = document.createElement('audio');
    audio.src = 'https://s19.aconvert.com/convert/p3r68-cdx67/yndjm-q4iy2.mp3'; // æ›¿æ›ç‚ºæ‚¨çš„éŸ³æ¨‚æ–‡ä»¶è·¯å¾‘
    audio.loop = true; // å¾ªç’°æ’­æ”¾
    audio.volume = 0.7; // éŸ³é‡è¨­ç½®ç‚º 50%
    document.body.appendChild(audio);
    audio.play();

    // æ·»åŠ éœéŸ³æŒ‰éˆ•
    const muteButton = document.createElement('button');
    muteButton.textContent = 'ğŸ”‡ éœéŸ³';
    muteButton.style.position = 'fixed';
    muteButton.style.bottom = '16px';
    muteButton.style.left = '16px';
    muteButton.style.padding = '10px 20px';
    muteButton.style.backgroundColor = '#4CAF50';
    muteButton.style.color = 'white';
    muteButton.style.border = 'none';
    muteButton.style.borderRadius = '5px';
    muteButton.style.cursor = 'pointer';
    muteButton.style.fontSize = '16px';
    document.body.appendChild(muteButton);

    let isMuted = false;
    muteButton.addEventListener('click', () => {
      isMuted = !isMuted;
      audio.muted = isMuted;
      muteButton.textContent = isMuted ? 'ğŸ”Š å–æ¶ˆéœéŸ³' : 'ğŸ”‡ éœéŸ³';
    });
  </script>

</body>
</html>